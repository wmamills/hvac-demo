# source the SDK setup script
. ~/opt/yoxen/2024.02.10/arm64/environment-setup-armv8a-poky-linux

# Make a script version of $CC and place it in the path first
# xen make does not honor preset CC, instead it sets it to ${CROSS_PREFIX}gcc
# It does honor CFLAGS CROSS_PREFIX and LDFLAGS
ORIG_CC="$CC"
ORIG_CFLAGS="$CFLAGS"
ORIG_LDFLAGS="$LDFLAGS"
CC_ARGS=$(echo "$CC" | cut -d " " -f2-)
CC=$(echo "$CC" | cut -d " " -f1)
CC_FULL=$(which $CC)
mkdir -p build/yocto-sdk/bin
echo '#!/bin/sh' >build/yocto-sdk/bin/$CC
echo "$CC_FULL $CC_ARGS \"\$@\"" >>build/yocto-sdk/bin/$CC
chmod +x build/yocto-sdk/bin/$CC
PATH=$PWD/build/yocto-sdk/bin:$PATH

unset LDFLAGS
export CARGO_TARGET_AARCH64_UNKNOWN_LINUX_GNU_LINKER=aarch64-poky-linux-gcc
export PKG_CONFIG=pkg-config
